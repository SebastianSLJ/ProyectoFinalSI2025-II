<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproduciendo Ahora - Spotify</title>
    <link rel="stylesheet" href="../static/player.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>REPRODUCIENDO AHORA</h1>
        </div>
        
        <div class="now-playing">
            <div class="album-art">
                <img id="album-image" src="https://i.scdn.co/image/ab67616d0000b2734c71e27f7c5c0c7d5b4a7f8a" alt="Portada del álbum">
            </div>
            
            <div class="track-info">
                <h2 class="track-name" id="track-name">Blinding Lights</h2>
                <p class="artist-name" id="artist-name">The Weeknd</p>
                <p class="album-name" id="album-name">After Hours</p>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress"></div>
                </div>
                <div class="time-info">
                    <span id="current-time">2:15</span>
                    <span id="total-time">3:20</span>
                </div>
            </div>
            
            <div class="controls">
                <button class="control-btn">⏮</button>
                <button class="control-btn play-pause">⏸</button>
                <button class="control-btn">⏭</button>
            </div>
        </div>
        
        <div class="footer">
            <p>Conectado a Spotify • Actualizado hace 5 segundos</p>
        </div>
    </div>
<script>
async function actualizar() {
  try {
    const response = await fetch('/estado');
    const data = await response.json();

    if (data.status) {
      // Si hay un mensaje de estado (probablemente "No se está reproduciendo nada")
      document.getElementById('track-name').textContent = data.status;
      document.getElementById('artist-name').textContent = '';
      document.getElementById('album-name').textContent = '';
      document.getElementById('album-image').src = '';
      document.getElementById('current-time').textContent = '0:00';
      document.getElementById('total-time').textContent = '0:00';
      document.querySelector('.progress').style.width = '0%';
    } else {
      // Si hay una canción reproduciéndose
      document.getElementById('track-name').textContent = data.cancion;
      document.getElementById('artist-name').textContent = data.artista;
      document.getElementById('album-name').textContent = data.album;
      document.getElementById('album-image').src = data.imagen_album;
      
      // Actualizar tiempos y progreso 
      document.getElementById('current-time').textContent = '0:00';
      document.getElementById('total-time').textContent = data.duracion;
      document.querySelector('.progress').style.width = '45%'; // Ejemplo estático
    }
  } catch (err) {
    console.error("Error actualizando estado:", err);
    document.getElementById('track-name').textContent = 'No hay musica en reproducción';
    document.getElementById('artist-name').textContent = '';
    document.getElementById('album-name').textContent = '';
  }
}

// Actualiza cada 5 segundos
setInterval(actualizar, 5000);
actualizar();
</script>
</body>
</html>